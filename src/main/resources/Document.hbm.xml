<?xml version="1.0" encoding="UTF-8"?>
 
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN" 
    "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">
 
<hibernate-mapping>

  <!-- ==================================================================== -->
  <!-- META -->
  <!-- ==================================================================== -->
  <query name="Meta.getAllDocumentIds">
    <![CDATA[
    SELECT m.id FROM Meta m ORDER BY m.id
    ]]>  
  </query>   
  
  <query name="Meta.getDocumentIdsInRange">
    <![CDATA[
    SELECT m.id FROM Meta m 
    WHERE m.id 
    BETWEEN :min AND :max 
    ORDER BY m.id
    ]]>  
  </query>   
  
  <query name="Meta.getMaxDocumentId">
    <![CDATA[
    SELECT max(m.id) FROM Meta m
    ]]>  
  </query> 
  
  <query name="Meta.getMinDocumentId">
    <![CDATA[
    SELECT min(m.id) FROM Meta m
    ]]>  
  </query>
  
  <query name="Meta.getMinMaxDocumentIds">
    <![CDATA[
    SELECT min(m.id), max(m.id) FROM Meta m
    ]]>
  </query>

  <!-- ==================================================================== -->
  <!-- VERSION -->
  <!-- ==================================================================== -->

  <!-- Unique -->
  <query name="DocumentVersion.getLatestVersion">
    <![CDATA[
	  SELECT v FROM DocumentVersion v
	  WHERE v.id IN (
	    SELECT max(v.id) FROM DocumentVersion v
	    WHERE v.docId = :docId)
	  )
    ]]>
  </query>

  <!-- Unique -->
  <query name="DocumentVersion.getDefaultVersion">
    <![CDATA[
	 SELECT v FROM DocumentVersion v, DefaultDocumentVersion d
	 WHERE v.no = d.no AND v.docId = d.docId AND v.docId = :docId
    ]]>
  </query>

  <!-- Unique -->
  <query name="DocumentVersion.getByDocIdAndNo">
    <![CDATA[
	  SELECT v FROM DocumentVersion v
	  WHERE v.docId = :docId AND v.no = :no
    ]]>
  </query>

  <!-- Collection -->
  <query name="DocumentVersion.getByDocId">
    <![CDATA[
      SELECT v FROM DocumentVersion v WHERE v.docId = :docId
    ]]>
  </query>
    
  <!-- ==================================================================== -->
  <!-- PROPERTIES -->
  <!-- ==================================================================== -->

  <!-- Unique -->
  <query name="DocumentProperty.getDocumentIdByAlias">
    <![CDATA[
		SELECT p.documentId
		FROM DocumentProperty p
		WHERE p.name = :name AND value= :value
    ]]>
  </query>

  <!-- Collection -->
  <query name="DocumentProperty.getAllAliases">
    <![CDATA[
		SELECT p.value
		FROM DocumentProperty p
		WHERE p.name = :name
		ORDER BY p.value
    ]]>
  </query>

  <!-- Unique -->
  <query name="DocumentProperty.getAliasProperty">
    <![CDATA[
		SELECT p FROM
		DocumentProperty p
		WHERE p.name = :name AND lower(p.value) = lower(:value)
    ]]>
  </query>    

  <!-- ==================================================================== -->
  <!-- CATEGORIES -->
  <!-- ==================================================================== -->

  <query name="CategoryType.getAllTypes">
    <![CDATA[
    SELECT t FROM CategoryType t ORDER BY t.name
    ]]>
  </query>

  <query name="CategoryType.getByName">
    <![CDATA[
    SELECT t FROM CategoryType t WHERE t.name = :name
    ]]>
  </query>

  <query name="Category.getByType">
    <![CDATA[
    SELECT c FROM Category c WHERE c.type = ?
    ]]>
  </query>

  <query name="Category.getByNameAndType">
    <![CDATA[
    SELECT c FROM Category c WHERE c.name = :name AND c.type = :type
    ]]>
  </query>

  <query name="Category.getAll">
    <![CDATA[
    FROM Category c ORDER BY c.type.name ASC, c.name ASC
    ]]>
  </query>

    
  <!-- ==================================================================== -->
  <!-- Html document -->
  <!-- ==================================================================== -->
  <query name="HtmlDoc.getReference">
    <![CDATA[
    FROM HtmlReference r WHERE r.docId = :docId AND r.docVersionNo = :docVersionNo
    ]]>
  </query>


  <!-- ==================================================================== -->
  <!-- Url document -->
  <!-- ==================================================================== -->
  <query name="UrlDoc.getReference">
    <![CDATA[
    FROM UrlReference r WHERE r.docId = :docId AND r.docVersionNo = :docVersionNo
    ]]>
  </query>

  <!-- ==================================================================== -->
  <!-- File document -->
  <!-- ==================================================================== -->
  <query name="FileDoc.getReferences">
    <![CDATA[
    FROM FileReference r WHERE r.docId = :docId AND r.docVersionNo = :docVersionNo ORDER BY r.defaultFileId DESC, r.fileId
    ]]>
  </query>

  <query name="FileDoc.deleteAllReferences">
    <![CDATA[
    DELETE FROM FileReference r WHERE r.docId = :docId AND r.docVersionNo = :docVersionNo
    ]]>
  </query>
    
</hibernate-mapping>