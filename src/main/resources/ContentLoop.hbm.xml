<?xml version="1.0" encoding="UTF-8"?>
 
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN" 
    "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">
 
<hibernate-mapping>
  <!--
  <query name="">
    <![CDATA[
    ]]>
  </query>    
  -->

  <!-- Unique -->  
  <query name="ContentLoop.getByMetaIdAndDocumentVersionAndNo">
    <![CDATA[
    SELECT l FROM ContentLoop l WHERE l.metaId = :metaId AND l.documentVersion = :documentVersion AND l.no = :no
    ]]>
  </query>


  <!-- List -->
  <query name="ContentLoop.getByMetaIdAndDocumentVersion">
    <![CDATA[
    SELECT l FROM ContentLoop l WHERE l.metaId = :metaId AND l.documentVersion = :documentVersion
    ]]>
  </query>   
  
  
  <query name="Content.getByLoopIdAndOrderIndex">
    <![CDATA[
		SELECT c FROM Content c
		WHERE c.loopId = :loopId AND c.orderIndex = :orderIndex  ORDER BY  c.orderIndex  
    ]]>
  </query>

    <!--
  <query name="Content.getNextIndexes">
    <![CDATA[
		SELECT
			min(c.orderIndex)    - 1,
			max(c.orderIndex)    + 1,
			max(c.index) + 1
        FROM
            ContentLoop l JOIN l.contents c
		WHERE l.id = :loopId    
    ]]>
  </query>
  -->
  
  <query name="Content.updateOrderIndex">
    <![CDATA[
		UPDATE Content c
		SET c.orderIndex = :orderIndex WHERE c.id = :id    
    ]]>
  </query>
  
  <query name="Content.delete">
    <![CDATA[
    DELETE FROM Content c WHERE c.id = :id
    ]]>
  </query>
  
  <query name="Content.getIdByLoopIdAndSequenceIndex">
    <![CDATA[
    SELECT c.id FROM Content c WHERE c.loopId = :loopId AND c.index = :sequenceIndex
    ]]>
  </query>


  <query name="Content.getPrevsByOrder">
    <![CDATA[
    SELECT c FROM Content c WHERE c.loopId = :loopId AND c.orderIndex < :orderIndex ORDER BY c.orderIndex DESC
    ]]>
  </query>

  <query name="Content.getNextsByOrder">
    <![CDATA[
    SELECT c FROM Content c WHERE c.loopId = :loopId AND c.orderIndex > :orderIndex ORDER BY c.orderIndex
    ]]>
  </query>
</hibernate-mapping>