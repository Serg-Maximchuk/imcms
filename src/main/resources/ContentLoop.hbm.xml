<?xml version="1.0" encoding="UTF-8"?>
 
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN" 
    "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">
 
<hibernate-mapping>
  <!--
  <query name="">
    <![CDATA[
    ]]>
  </query>    
  -->

  <query name="ContentLoop.getByMetaIdAndMetaVersionAndIndex">
    <![CDATA[
    SELECT l FROM ContentLoop l WHERE l.metaId = :metaId AND l.metaVersion = :metaVersion AND l.no = :index
    ]]>
  </query>

  
  <query name="ContentLoop.getByMetaIdAndMetaVersion">
    <![CDATA[
    SELECT l FROM ContentLoop l WHERE l.metaId = :metaId AND l.metaVersion = :metaVersion
    ]]>
  </query>   
  
  
  <query name="Content.getByLoopIdAndOrderIndex">
    <![CDATA[
		SELECT c FROM Content c
		WHERE c.loopId = :loopId AND c.orderIndex = :orderIndex    
    ]]>
  </query>
  
  <query name="Content.getNextIndexes">
    <![CDATA[
		SELECT
			min(c.orderIndex)    - 1,
			max(c.orderIndex)    + 1,
			max(c.sequenceIndex) + 1
        FROM
            ContentLoop l JOIN l.contents c
		WHERE l.id = :loopId    
    ]]>
  </query>
  
  <query name="Content.updateOrderIndex">
    <![CDATA[
		UPDATE Content c
		SET c.orderIndex = :orderIndex WHERE c.id = :id    
    ]]>
  </query>
  
  <query name="Content.delete">
    <![CDATA[
    DELETE FROM Content c WHERE c.id = :id
    ]]>
  </query>
  
  <query name="Content.getContentIdByLoopIdAndSequenceIndex">
    <![CDATA[
    SELECT c.id FROM Content c WHERE c.loopId = :loopId AND c.sequenceIndex = :sequenceIndex
    ]]>
  </query>
</hibernate-mapping>