<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
        "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">

<hibernate-mapping>

    <!-- Unique -->
    <query name="DocVersion.findByDocIdAndNo">
    <![CDATA[
        SELECT v FROM DocVersion v WHERE v.docId = ?1 AND v.no = ?2
    ]]>
    </query>


    <!-- Unique -->
    <query name="DocVersion.findLatest">
    <![CDATA[
        SELECT v FROM DocVersion v
        WHERE v.id = (
            SELECT max(v.id) FROM DocVersion v
            WHERE v.docId = ?1
        )
    ]]>
    </query>

    <!-- Unique -->
    <query name="DocVersion.findDefault">
    <![CDATA[
        SELECT v FROM Meta m, DocVersion v
        WHERE m.defaultVersionNo = v.no AND m.id = v.docId AND m.id = ?1
    ]]>
    </query>

    <query name="DocVersion.setDefault">
    <![CDATA[
        UPDATE Meta m
        SET m.defaultVersionNo = :defaultVersionNo, m.publisherId = :publisherId
        WHERE m.id = :docId
    ]]>
    </query>

    <!-- Collection -->
    <query name="DocVersion.getByDocId">
    <![CDATA[
        SELECT v FROM DocVersion v WHERE v.docId = ?1
    ]]>
    </query>

</hibernate-mapping>