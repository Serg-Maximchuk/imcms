<html>
<head>
<title><? templates/sv/FileAdmin.html/1 ?></title>

<link rel="stylesheet" type="text/css" href="$contextPath/imcms/css/imcms_admin.css.jsp">
<script src="$contextPath/imcms/$language/scripts/imcms_admin.js" type="text/javascript"></script>

<script language="JavaScript">
<!--

/* *******************************************************************
 *           SETTINGS                                                *
 ******************************************************************* */

var imC_PATH = "$contextPath" ;
var JSP_PATH = "$contextPath/imcms/$language/jsp" ;

/* *******************************************************************
 *           FUNCTIONS                                               *
 ******************************************************************* */

var ns    = (document.layers) ? 1 : 0;
var ie    = (document.all) ? 1 : 0;
var moz   = (document.getElementById) ? 1 : 0;
var gecko = (moz && !ie) ? 1 : 0;
var isMac = (/mac/i.test(navigator.platform)) ? 1 : 0;

var webRoot = "";

aDir = new Array(3); // absolutedir[iside]
aDir[0] = "";
aDir[1] = "";
aDir[2] = "";
wDir = new Array(3); // webdir[iside]
wDir[0] = "";
wDir[1] = "";
wDir[2] = "";

/* ***** REGEXP PATTERNS ***** */
	/* isImage - image types (change in "FileAdmin_preview.jsp" too) */
var pai = "\\.(GIF|JPE?G|PNG)$";
	/* isViewFile - viewable file types (change in "FileAdmin_preview.jsp" too, if image) */
var pa  = "(\\.(GIF|JPE?G|PNG|BMP|AVI|MPE?G|HTML?|CSS|JS|VBS|TXT|INC|JSP|ASP|FRAG)$)|(\\.LOG)";
	/* isEditFileText - viewable file types that will open in readonly mode in "FileAdmin_edit.jsp" */
var pat = "(\\.(HTML?|CSS|JS|VBS|TXT|INC|JSP|ASP|FRAG)$)|(\\.LOG)";
	/* isEditFile - editable file types (change in "FileAdmin_edit.jsp" too) */
var pae = "\\.(HTML?|CSS|JS|VBS|TXT|FRAG)$";
	/* isDir */
var isDirectoryPattern = "(\\\\|\\.)$";
	/* isSysFold */
var pas = "webapps|[\\.]{2}";
	/* isHiddenFold */
var pao = "WEB-INF";
	/* isHtmlFile */
var pah = "\\.html?$";
	/* isStatFile */
var par = "\\\\stats\\\\.+\\.html?";

function checkFileType(iside, doReset) {
	if (!(isMac && ie)) {
		var f = document.forms[0];
		/* Viewable file */
		if (!doReset && isFile(iside) && (isViewFile(iside) || isStatFile(iside) || (isHtmlFile && !isHiddenFold(iside)))) {
			if (iside == 2) {
				f.preview2.disabled  = 0;
				f.preview2.className = "imcmsFormBtnSmall";
			} else {
				f.preview1.disabled  = 0;
				f.preview1.className = "imcmsFormBtnSmall";
			}
		} else {
			if (iside == 2) {
				f.preview2.disabled  = 1;
				f.preview2.className = "imcmsFormBtnSmallDisabled";
			} else {
				f.preview1.disabled  = 1;
				f.preview1.className = "imcmsFormBtnSmallDisabled";
			}
		}
		/* All files */
		if (!doReset && isFile(iside)) {
			if (iside == 2) {
				f.download2.disabled  = 0;
				f.download2.className = "imcmsFormBtnSmall";
			} else {
				f.download1.disabled  = 0;
				f.download1.className = "imcmsFormBtnSmall";
			}
		} else {
			if (iside == 2) {
				f.download2.disabled  = 1;
				f.download2.className = "imcmsFormBtnSmallDisabled";
			} else {
				f.download1.disabled  = 1;
				f.download1.className = "imcmsFormBtnSmallDisabled";
			}
		}
		/* Editable files */
		if (!doReset && isEditFile(iside)) {
			if (iside == 2) {
				f.edit2.disabled  = 0;
				f.edit2.className = "imcmsFormBtnSmall";
			} else {
				f.edit1.disabled  = 0;
				f.edit1.className = "imcmsFormBtnSmall";
			}
		} else {
			if (iside == 2) {
				f.edit2.disabled  = 1;
				f.edit2.className = "imcmsFormBtnSmallDisabled";
			} else {
				f.edit1.disabled  = 1;
				f.edit1.className = "imcmsFormBtnSmallDisabled";
			}
		}
		/* System folders (default installed & locked) */
		if (doReset || isSysFold(iside) || getFile(iside) == "") {
			if (iside == 2) {
				f.copy2.disabled    = 1;
				f.move2.disabled    = 1;
				f.delete2.disabled  = 1;
				f.copy2.className   = "imcmsFormBtnSmallDisabled";
				f.move2.className   = "imcmsFormBtnSmallDisabled";
				f.delete2.className = "imcmsFormBtnSmallDisabled";
			} else {
				f.copy1.disabled    = 1;
				f.move1.disabled    = 1;
				f.delete1.disabled  = 1;
				f.copy1.className   = "imcmsFormBtnSmallDisabled";
				f.move1.className   = "imcmsFormBtnSmallDisabled";
				f.delete1.className = "imcmsFormBtnSmallDisabled";
			}
		} else {
			if (iside == 2) {
				f.copy2.disabled    = 0;
				f.move2.disabled    = 0;
				f.delete2.disabled  = 0;
				f.copy2.className   = "imcmsFormBtnSmall";
				f.move2.className   = "imcmsFormBtnSmall";
				f.delete2.className = "imcmsFormBtnSmall";
			} else {
				f.copy1.disabled    = 0;
				f.move1.disabled    = 0;
				f.delete1.disabled  = 0;
				f.copy1.className   = "imcmsFormBtnSmall";
				f.move1.className   = "imcmsFormBtnSmall";
				f.delete1.className = "imcmsFormBtnSmall";
			}
		}
	}
}

function isViewFile(iside) {
	re = new RegExp(pa, 'gi');
	var sfile = getFile(iside);
	return re.test(sfile);
}

function isImageFile(iside) {
	re = new RegExp(pai, 'gi');
	var sfile = getFile(iside);
	return re.test(sfile);
}

function isEditFile(iside) {
	re = new RegExp(pae, 'gi');
	var sfile = getFile(iside);
	var retVal = re.test(sfile);
	/* don't allow edit of statfiles */
	if (isStatFile(iside)) {
		retVal = false;
	}
	return retVal;
}

function isFile(iside) {
	re = new RegExp(isDirectoryPattern, 'gi');
	var sfile = getFile(iside);
	return !re.test(sfile);
}

function isSysFold(iside) {
	re = new RegExp(pas, 'gi');
	var sfile = getFile(iside);
	return re.test(sfile);
}

function isHiddenFold(iside) {
	re = new RegExp(pao, 'g');
	var sfile = (getFile(iside).indexOf(":") != -1) ? getFile(iside) : aDir[iside] + "\\" + getFile(iside);
	return re.test(sfile);
}

function isHtmlFile(iside) {
	re = new RegExp(pah, 'gi');
	var sfile = getFile(iside);
	return re.test(sfile);
}

function isEditFileText(iside) {
	re = new RegExp(pat, 'gi');
	var sfile = getFile(iside);
	return re.test(sfile);
}

function isStatFile(iside) {
	re = new RegExp(par, 'gi');
	var sfile = (getFile(iside).indexOf(":") != -1) ? getFile(iside) : aDir[iside] + "\\" + getFile(iside);
	return re.test(sfile);
}

function dblClickAction(iside) {
	if (!(isMac && ie)) {
		if (isImageFile(iside) || isStatFile(iside)) {
			//alert("1") ;
			previewFile(iside);
		} else if (isHtmlFile(iside) && !isHiddenFold(iside)) {
			//alert("2") ;
			openFile(iside);
		} else if (isEditFileText(iside)) {
			//alert("3") ;
			editFile(iside,1);
		} else if (isFile(iside) || isViewFile(iside)) {
			//alert("4") ;
			var fBtn = eval('document.forms[0].download' + iside);
			fBtn.click();
		} else {
			//alert("5") ;
			var fBtn = eval('document.forms[0].change' + iside);
			fBtn.click();
		}
	}
}

function previewFile(iside) {
	var f = document.forms[0];
	var sdir = (iside == 2) ? f.dir2w.value : f.dir1w.value;
	var sfile = getFile(iside);
	sfile = (webRoot != "") ? webRoot + '/' + sfile : wDir[iside] + '/' + sfile;
	if (isStatFile(iside)) { // stat
		//alert("1") ;
		popWinOpen(800,570,JSP_PATH + "/FileAdmin_preview.jsp?isStat=1&file=" + escape(sfile),"filePreview",1,0);
	} else if (isHtmlFile(iside) && !isHiddenFold(iside)) { // html
		//alert("2") ;
		openFile(iside);
	} else if (isEditFileText(iside)) { // view textfiles "readonly"
		//alert("3") ;
		editFile(iside,1);
	} else if (isImageFile(iside)) { // file
		//alert("4") ;
		popWinOpen(800,570,JSP_PATH + "/FileAdmin_preview.jsp?file=" + escape(sfile),"filePreview",1,0);
	} else if (isFile(iside)) { // other files
		//alert("5") ;
		var fBtn = eval('document.forms[0].download' + iside);
		fBtn.click();
	}
}

function openFile(iside) {
	var f = document.forms[0];
	var sdir = (iside == 2) ? f.dir2w.value : f.dir1w.value;
	var sfile = getFile(iside);
	sfile = (webRoot != "") ? webRoot + '/' + sfile : wDir[iside] + '/' + sfile;
	window.open(imC_PATH + sfile);
}

function editFile(iside,readonlyFlag) {
	var f = document.forms[0];
	var sdir = (iside == 2) ? f.dir2w.value : f.dir1w.value;
	var sfile = getFile(iside);
	sfile = (webRoot != "") ? webRoot + '/' + sfile : wDir[iside] + '/' + sfile;
	readonlyFlag = (readonlyFlag) ? "&readonly=1" : "";
	popWinOpen(800,570,JSP_PATH + "/FileAdmin_edit.jsp?file=" + escape(sfile) + readonlyFlag,"fileEdit",1,0);
}

function getFile(iside) {
	var f = document.forms[0];
	var theVal = "";
	switch (iside) {
		case 1:
			if (f.files1.selectedIndex > -1) theVal = f.files1.options[f.files1.selectedIndex].value;
		break;
		case 2:
			if (f.files2.selectedIndex > -1) theVal = f.files2.options[f.files2.selectedIndex].value;
		break;
	}
	return theVal;
}

function setSelectedFolder(iside) {
	if (moz) {
		var f = document.forms[0];
		switch (iside) {
			case 1:
				for (var i = 0; i < f.files1.length; i++) {
					if (f.files1.options[i].value == f.dir1.value + "\\") {
						f.files1.options[i].style.backgroundColor = "#FFFF99"; // the Dir
					} else  if (f.dir1.value.indexOf(f.files1.options[i].value.substring(0,f.files1.options[i].value.length-1)) != -1 && f.files1.options[i].value.indexOf("\\") != -1) {
						f.files1.options[i].style.backgroundColor = "#FFFFCC"; // a subDir
					}
				}
			break;
			case 2:
				for (var i = 0; i < f.files2.length; i++) {
					if (f.files2.options[i].value == f.dir2.value + "\\") {
						f.files2.options[i].style.backgroundColor = "#FFFF99"; // the Dir
					} else  if (f.dir2.value.indexOf(f.files2.options[i].value.substring(0,f.files2.options[i].value.length-1)) != -1 && f.files2.options[i].value.indexOf("\\") != -1) {
						f.files2.options[i].style.backgroundColor = "#FFFFCC"; // a subDir
					}
				}
			break;
		}
	}
}
//-->
</script>


</head>
<body bgcolor="#FFFFFF" onLoad="checkFileType(1,true); checkFileType(2,true); setSelectedFolder(1); setSelectedFolder(2);">

#gui_outer_start()
#gui_head( "<? templates/sv/FileAdmin.html/1001 ?>" )
<table border="0" cellspacing="0" cellpadding="0" width="100%">
<form method="post" action="FileAdmin" enctype="multipart/form-data">
<input type="hidden" name="dir1" value="#dir1#">
<input type="hidden" name="dir2" value="#dir2#">
<input type="hidden" name="dir1w" value="#dir1#">
<input type="hidden" name="dir2w" value="#dir2#">
<tr>
	<td><input class="imcmsFormBtn" height="22" type="submit" name="cancel" value="<? templates/sv/FileAdmin.html/2022 ?>"></td>
	<td align="right"><input class="imcmsFormBtn" type="button" value="<? global/help ?>" onClick="openHelpW('2'); return false;"></td>
</tr>
</table>
#gui_mid()

<table border="0" cellspacing="0" cellpadding="0" width="760" align="center">
<tr>
  <td colspan="2" class="small"><? templates/sv/FileAdmin.html/3 ?></td>
  <td colspan="2">&nbsp;</td>
  <td colspan="2" align="right" class="small"><? templates/sv/FileAdmin.html/4 ?></td>
</tr>
<tr>
	<td colspan="8">#gui_hr( "blue" )</td>
</tr>
<tr>
  <td colspan="2">
	<table border="0" cellpadding="0" cellspacing="0" width="100%">
	<tr>
		<td align="right"><input
		type="submit" name="change1" class="imcmsFormBtnSmall" height="22" value="<? templates/sv/FileAdmin.html/2001 ?>"></td>
	</tr>
	<tr>
		<td><img src="$contextPath/imcms/$language/images/admin/1x1.gif" width="1" height="2"></td>
	</tr>
	<tr>
		<td align="right"><span class="imcmsAdmForm">
		<select name="files1" id="fileSel_1" size="20" class="imcmsAdmForm" style="width:330"
			onChange="checkFileType(1,false)"
			onDblClick="dblClickAction(1)" multiple>
	#files1#
		</select></span></td>
	</tr>
	</table></td>

  <td colspan="2" align="center">
	<table border="0" cellpadding="2" cellspacing="0">
	<tr>
		<td colspan="2" align="center" class="small"><? templates/sv/FileAdmin.html/6 ?></td>
	</tr>
	<tr>
		<td align="right"><input class="imcmsFormBtnSmall" height="22" type="submit" name="delete1" value="&nbsp;<? templates/sv/FileAdmin.html/2002 ?>&nbsp;"></td>
		<td><input class="imcmsFormBtnSmall" height="22" type="submit" name="delete2" value="&nbsp;<? templates/sv/FileAdmin.html/2003 ?>&nbsp;"></td>
	</tr>
	<tr>
		<td colspan="2" align="center" class="small">
		<img src="$contextPath/imcms/$language/images/admin/line_hr2.gif" width="50" height="6"><? templates/sv/FileAdmin.html/7 ?></td>
	</tr>
	<tr>
		<td align="right"><input class="imcmsFormBtnSmall" height="22" type="submit" name="move2" value="<? templates/sv/FileAdmin.html/2004 ?>"></td>
		<td><input class="imcmsFormBtnSmall" height="22" type="submit" name="move1" value="<? templates/sv/FileAdmin.html/2005 ?>"></td></td>
	</tr>
	<tr>
		<td colspan="2" align="center" class="small">
		<img src="$contextPath/imcms/$language/images/admin/line_hr2.gif" width="50" height="6"><? templates/sv/FileAdmin.html/8 ?></td>
	</tr>
	<tr>
		<td align="right"><input class="imcmsFormBtnSmall" height="22" type="submit" name="copy2" value="&nbsp;<? templates/sv/FileAdmin.html/2006 ?>&nbsp;"></td>
		<td><input class="imcmsFormBtnSmall" height="22" type="submit" name="copy1" value="&nbsp;<? templates/sv/FileAdmin.html/2007 ?>&nbsp;"></td>
	</tr>
	<tr>
		<td colspan="2" align="center" class="small">
		<img src="$contextPath/imcms/$language/images/admin/line_hr2.gif" width="50" height="6"><? templates/sv/FileAdmin.html/1002 ?></td>
	</tr>
	<tr>
		<td align="right"><input class="imcmsFormBtnSmall" height="22" type="submit" name="download1" value="&nbsp;<? templates/sv/FileAdmin.html/2008 ?>&nbsp;"></td>
		<td><input class="imcmsFormBtnSmall" height="22" type="submit" name="download2" value="&nbsp;<? templates/sv/FileAdmin.html/2009 ?>&nbsp;"></td>
	</tr>
	<tr>
		<td colspan="2" align="center" class="small">
		<img src="$contextPath/imcms/$language/images/admin/line_hr2.gif" width="50" height="6"><? templates/sv/FileAdmin.html/9 ?></td>
	</tr>
	<tr>
		<td align="right"><input class="imcmsFormBtnSmall" height="22" type="button" name="preview1" value="&nbsp;<? templates/sv/FileAdmin.html/2010 ?>&nbsp;" onClick="previewFile(1)"></td>
		<td><input class="imcmsFormBtnSmall" height="22" type="button" name="preview2" value="&nbsp;<? templates/sv/FileAdmin.html/2011 ?>&nbsp;" onClick="previewFile(2)"></td>
	</tr>
	<tr>
		<td colspan="2" align="center" class="small">
		<img src="$contextPath/imcms/$language/images/admin/line_hr2.gif" width="50" height="6"><? templates/sv/FileAdmin.html/10 ?></td>
	</tr>
	<tr>
		<td align="right"><input class="imcmsFormBtnSmall" height="22" type="button" name="edit1" value="&nbsp;<? templates/sv/FileAdmin.html/2012 ?>&nbsp;" onClick="editFile(1,0);"></td>
		<td><input class="imcmsFormBtnSmall" height="22" type="button" name="edit2" value="&nbsp;<? templates/sv/FileAdmin.html/2013 ?>&nbsp;" onClick="editFile(2,0);"></td>
	</tr>
	</table></td>

  <td colspan="2" align="right">
	<table border="0" cellpadding="0" cellspacing="0" width="100%">
	<tr>
		<td><input type="submit" name="change2"
		class="imcmsFormBtnSmall" height="22" value="<? templates/sv/FileAdmin.html/2014 ?>"></td>
	</tr>
	<tr>
		<td><img src="$contextPath/imcms/$language/images/admin/1x1.gif" width="1" height="2"></td>
	</tr>
	<tr>
		<td>
		<span class="imcmsAdmForm">
		<select name="files2" id="fileSel_2" size="20" class="imcmsAdmForm" style="width:330"
			onChange="checkFileType(2,false)"
			onDblClick="dblClickAction(2)" multiple>
	#files2#
		</select></span></td>
	</tr>
	</table></td>
</tr>
<tr>
	<td colspan="6"><img src="$contextPath/imcms/$language/images/admin/1x1.gif" width="1" height="8"></td>
</tr>
<tr>
  <td><input class="imcmsFormBtnSmall" height="22" style="width:90" type="submit" name="upload1" value="<? templates/sv/FileAdmin.html/2015 ?>"></td>
  <td colspan="4" align="center"><span class="imcmsAdmForm"><? templates/sv/FileAdmin.html/1003 ?>&nbsp;
<script language="JavaScript">
<!--
if (gecko && !isMac) {
	document.write("<input type=\"file\" name=\"file\" class=\"imcmsAdmForm\" size=\"60\" style=\"width:380\">");
} else if (gecko && isMac) {
	document.write("<input type=\"file\" name=\"file\" class=\"imcmsAdmForm\" size=\"50\">");
} else if (ns) {
	document.write("<input type=\"file\" name=\"file\" class=\"imcmsAdmForm\" size=\"20\">");
} else {
	document.write("<input type=\"file\" name=\"file\" class=\"imcmsAdmForm\" size=\"20\" style=\"width:380\">");
}
//-->
</script>
<noscript><input type="file" name="file" class="imcmsAdmForm" size="20"></noscript></span></td>
  <td align="right"><input class="imcmsFormBtnSmall" height="22" style="width:90" type="submit" name="upload2" value="<? templates/sv/FileAdmin.html/2016 ?>"></td>
</tr>
<tr>
  <td colspan="6">#gui_hr( "blue" )</td>
</tr>
<tr>
  <td align="left"><input
	type="submit" name="rename1"class="imcmsFormBtnSmall" height="22" style="width:90"
		value="<? templates/sv/FileAdmin.html/2017 ?>"><br><img
	src="$contextPath/imcms/$language/images/admin/1x1.gif" width="1" height="2"><br><input
	type="submit" name="mkdir1" class="imcmsFormBtnSmall" height="22" style="width:90"
		value="<? templates/sv/FileAdmin.html/2018 ?>"></td>
  <td colspan="4" align="center"><? templates/sv/FileAdmin.html/13 ?>
	<span class="imcmsAdmForm"><input type="text" name="name" class="imcmsAdmForm"></span></td>
  <td align="right"><input
	type="submit" name="rename2" class="imcmsFormBtnSmall" height="22" style="width:90"
		value="<? templates/sv/FileAdmin.html/2019 ?>"><br><img
	src="$contextPath/imcms/$language/images/admin/1x1.gif" width="1" height="2"><br><input
	type="submit" name="mkdir2" class="imcmsFormBtnSmall" height="22" style="width:90"
		value="<? templates/sv/FileAdmin.html/2020 ?>"></td>
</tr>
<tr>
  <td colspan="6">#gui_hr( "blue" )</td>
</tr>
<tr>
  <td colspan="6" align="right"><input class="imcmsFormBtn" height="22" type="submit" name="cancel" value="<? templates/sv/FileAdmin.html/2022 ?>"></td>
</tr>
<tr>
  <td><img src="$contextPath/imcms/$language/images/admin/1x1.gif" width="150" height="1"></td>
  <td><img src="$contextPath/imcms/$language/images/admin/1x1.gif" width="180" height="1"></td>
  <td colspan="2"><img src="$contextPath/imcms/$language/images/admin/1x1.gif" width="80" height="1"></td>
  <td><img src="$contextPath/imcms/$language/images/admin/1x1.gif" width="180" height="1"></td>
  <td><img src="$contextPath/imcms/$language/images/admin/1x1.gif" width="150" height="1"></td>
</tr>
</form>
</table>
#gui_bottom()
#gui_outer_end()

<script language="JavaScript">
<!--
/*
 * Figure out the webpath when knowing the absolute path.
 * Put them in an easy accessable, array[what_side] array.
 */

var actDir1 = document.forms[0].dir1.value;
var actDir2 = document.forms[0].dir2.value;

webDir1 = (/webapps/i.test(actDir1)) ? actDir1.substring(actDir1.indexOf("webapps") + 8, actDir1.length) : "";
webDir1 = webDir1.replace(/\\/g, "/");
webDir1 = (webDir1.indexOf("/") != -1) ? webDir1.substring(webDir1.indexOf("/"), webDir1.length) : "";

webDir2 = (/webapps/i.test(actDir2)) ? actDir2.substring(actDir2.indexOf("webapps") + 8, actDir2.length) : "";
webDir2 = webDir2.replace(/\\/g, "/");
webDir2 = (webDir2.indexOf("/") != -1) ? webDir2.substring(webDir2.indexOf("/"), webDir2.length) : "";

aDir[1] = actDir1;
aDir[2] = actDir2;
wDir[1] = webDir1;
wDir[2] = webDir2;

/*
 * make the file-select's wider.
 * if supported and > 800 in screen resolution.
 */

if (moz) {
	if (parseInt(screen.width) > 800) {
		document.getElementById("fileSel_1").style.width = 400;
		document.getElementById("fileSel_2").style.width = 400;
	}
}
//-->
</script>

</body>
</html>
