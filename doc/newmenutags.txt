Request For Comments

imRFC, imCMS-menytaggar, version 1.

Dokumentversion 1.2.

Dokumentversionslogg:

1.2	Plockade bort #saveSortStart*#, #saveSortStop*#, och #addDoc*#. Numera onödiga. (Förhoppningsvis.)
	Lade till nya taggar, med mer enhetligt utseende.
	Lade till distinktion mellan "datataggar" (#tagg#) och "menytaggar" (<?tagg?>), samt beskrivning och ett exempel för "datataggar".
1.1	Lade till #-taggar till exemplen på Pärs begäran, och rättade några småfel.
1.0	Första versionen. Beskriver imCMS nya menyer, version 1.

Christoffer "Kreiger" Hammarström.


Menytaggarna i imCMS v1.3 är de följande:

Taggar som ersätts av data ("datataggar"):

#menuitemlink# #/menuitemlink#
#menuitemheadline#
#menuitemtext#
#menuitemimage#
#menuitemdatecreated#
#menuitemdatemodified#

Dessa kan endast finnas endast i en meny.

Taggar som avgränsar html-kod, och definierar en meny ("menytaggar"):

<?imcms:menu?>
<?imcms:menuloop?>
<?imcms:menuitem?>
<?imcms:menuitemhide?>

Samtliga "menytaggar" kräver en avslutningstagg.

Beskrivning av taggarna följer.

	    #menuitemlink#

Den här taggen är den enda "datatagg" som egentligen är nödvändig i en funktionell meny. Den avslutas med #/menuitemlink#.
Den markerar två saker.
För det första skapar den en html-länk till underdokumentet. (#menuitemlink# ersätts av "<a href=...>", och #/menuitemlink# ersätts av "</a>")
För det andra så markerar den var "sorteringsrutan" (för manuell sortering av underdokumenten) och "arkiveringskryssrutan" (som används för att markera dokument att arkivera), respektive "administrationsmarkören" (oftast en liten pil), hamnar, i administrationsläge.
Sorteringsrutan och arkiveringskryssrutan hamnar precis framför länken. (framför "<a href=...>")
Administrationsmarkören hamnar precis bakom länken (efter "</a>")

		
            #menuitemheadline#

Den här taggen ersätts av rubriken för aktuell menuitem.


            #menuitemtext#

Den här taggen ersätts av "undertexten" för aktuell menuitem.


            #menuitemimage#

Den här taggen ersätts av bilden för aktuell menuitem.


            #menuitemdatecreated#

Den här taggen ersätts av datumet då aktuell menuitem skapades.


            #menuitemdatemodified#

Den här taggen ersätts av datumet då aktuell menuitem ändrades.


	    <?imcms:menu?> / <?imcms:menu no="menynummer"?>

Den här elementet innehåller en meny och är det enda element som är nödvändigt för en meny. Det avslutas med "<?/imcms:menu?>".

Om man inte explicit anger ett menynummer kommer den att anta värdet av en räknare som räknar upp för varje onumrerad meny i sidan.
D.v.s, den första onumrerade menyn kommer att få nummer ett, nästa nummer två, och så vidare.
Allting mellan start-taggen och slut-taggen kommer att plockas bort om det inte finns någonting att stoppa in i menyn.



	    <?imcms:menuitem?>

Den här taggen påbörjar en underdokumentsmall, d.v.s. mallen för ett underdokument (en "menuitem"), och avslutas med "<?/imcms:menuitem?>".
Den här taggen kan endast finnas inuti ett imcms:menu-element eller ett imcms:menuloop-element.
Om detta element saknas kommer istället hela innehållet i imcms:menuloop-element att användas.
Om också det saknas, kommer hela innehållet i imcms:menu-elementet att användas.

För varje imcms:menuitem-element i mallen, 
kommer det att stoppas in data för ett underdokument från databasen, i taggar, så länge det finns.
Om det finns fler underdokument än det finns imcms:menuitem-element i mallen, kommer alla imcms:menuitem-element loopa.

Varje menuitem skrivs ut minst en gång, och varje loop genomförs till fullo.
Det innebär att imcms:menuitem-element kommer att sluta skrivas ut först när det sista blir utskrivet.

Exempel: Det finns 5 underdokument (UD) från databasen, men bara två imcms:menuitem-element (MI).
UD kommer att stoppas in i MI på följande vis: 
MI 1 - UD 1
MI 2 - UD 2
MI 1 - UD 3
MI 2 - UD 4
MI 1 - UD 5
MI 2 - Tomt 



	    <?imcms:menuloop?>

Den här taggen påbörjar en loop, och avslutas med "<?/imcms:menuloop?>".
Den här taggen kan endast finnas inuti ett imcms:menu-element.

Om man inte vill att allting i imcms:menu-elementet ska loopa,
använder man sig av imcms:menuloop för att avgränsa det stycke man vill ska loopa.



            <?imcms:menuitemhide?>

Den här taggen använder man i imcms:menuitem-element. Den avslutas med "<?/imcms:menuitemhide?>".
Den avgränsar allt som inte ska synas, när man fått slut på underdokument från databasen, men fortfarande har imcms:menuitem-element kvar att skriva ut.



Här följer några html-exempel, med kommentarer:



<!-- Exempel 1a. Den enklaste sortens meny. Bara en lista på länkar. -->

  <?imcms:menu?>                                       <!-- Här påbörjas en meny. Om det är den första som saknar nummer, kommer den att få nummer 1 -->

  #menuitemlink# #menuitemheadline# #/menuitemlink#<br><!-- En länk till underdokumentet, med dess rubrik som länktext, och en radbrytning. -->

  <?/imcms:menu?>                                      <!-- Här avslutas menyn. -->

<!-- Resultatexempel 1a, tre underdokument:

    <a href="GetDoc?meta_id=1001">Dokument 1001</a><br>


    <a href="GetDoc?meta_id=1002">Dokument 1002</a><br>


    <a href="GetDoc?meta_id=1003">Dokument 1003</a><br>

        Slut på resultatexempel.
  -->


<!-- Exempel 1b. Som 1a, men med fler sorters data att stoppa in. -->

  <?imcms:menu?>                                          <!-- Här påbörjas en meny. Om det är den första som saknar nummer, kommer den att få nummer 1 -->

    Skapat: #menuitemdatecreated# <br>		          <!-- Datumet dokumentet skapades. -->

    Ändrat: #menuitemdatemodified# <br>		          <!-- Datumet dokumentet senast ändrades. -->

    #menuitemlink# #menuitemheadline# #/menuitemlink#<br> <!-- En länk till underdokumentet, med dess rubrik som länktext, och en radbrytning. -->

    #menuitemimage#		                          <!-- En eventuell bild för det här dokumentet. -->

    #menuitemtext# <br>					  <!-- "Undertexten" för dokumentet -->

  <?/imcms:menu?>                                         <!-- Här avslutas menyn. -->


<!-- Resultatexempel 1b, tre underdokument:

    Skapat: 2001-01-01 <br>

    Ändrat: 2001-01-02 <br>

    <a href="GetDoc?meta_id=1001"> Dokument 1001 </a><br>

    <img src="bild_1001.gif" border="0">

    Undertext för dokument 1001 <br>

    Skapat: 2001-02-01 <br>

    Ändrat: 2001-02-02 <br>

    <a href="GetDoc?meta_id=1002"> Dokument 1002 </a><br>

    <img src="bild_1002.gif" border="0">

    Undertext för dokument 1002 <br>

    Skapat: 2001-03-01 <br>

    Ändrat: 2001-03-02 <br>

    <a href="GetDoc?meta_id=1003"> Dokument 1003 </a><br>

    <img src="bild_1003.gif" border="0">

    Undertext för dokument 1003 <br>

        Slut på resultatexempel.
  -->


<!-- Exempel 2a. En något mer avancerad meny, med rubriker som växlar mellan två färger. -->

  <?imcms:menu no="2"?>                                  <!-- Menyn påbörjas. Nummer två i sidan. -->

    <?imcms:menuitem?>                                   <!-- Första underdokumentsmallen påbörjas. -->

      <font color="red"> En länk: </font>                <!-- Texten "En länk:" i röd färg. -->

      #menuitemlink##menuitemheadline##/menuitemlink#<br><!-- En länk till underdokumentet, med dess rubrik som länktext, och en radbrytning. -->

    <?/imcms:menuitem?>                                  <!-- Första underdokumentsmallen avslutas. -->

    <?imcms:menuitem?>                                   <!-- Andra underdokumentsmallen påbörjas. -->

      <font color="green"> En länk: </font>              <!-- Texten "En länk:" i grön färg. -->

      #menuitemlink##menuitemheadline##/menuitemlink#<br><!-- En länk till underdokumentet, med dess rubrik som länktext, och en radbrytning. -->

    <?/imcms:menuitem?>                                  <!-- Andra underdokumentsmallen avslutas. -->

  <?/imcms:menu?>                                        <!-- Menyn avslutas. -->

<!-- Resultatexempel 2a, tre underdokument:

      <font color="red"> En länk: </font>

      <a href="GetDoc?meta_id=1001">Dokument 1001</a><br>


      <font color="green"> En länk: </font>

      <a href="GetDoc?meta_id=1002">Dokument 1002</a><br>


      <font color="red"> En länk: </font>

      <a href="GetDoc?meta_id=1003">Dokument 1003</a><br>


      <font color="green"> En länk: </font>

      <br>

        Slut på resultatexempel.
  -->

<!-- 

     Resultatexempel 2a visar tydligt ett problem: 
     Vi har bara tre underdokument, men vi har två underdokumentmallar.
     Notera vad som händer med den fjärde posten i menyn: 

     "
      <font color="green"> En länk: </font>

      <br>
     "

     Efter att ha loopat över underdokumentmallarna en gång, och stoppat in tre underdokument, så finns det en underdokumentmall kvar att skriva ut.
     Eftersom det inte finns något att stoppa in i taggarna i denna underdokumentmall tas de helt sonika bort, vilket leder till texten "En länk:", utan en dylik.
     Detta leder oss till behovet av taggen "<?imcms:menuitemhide?>".

  -->


<!-- Exempel 2b. Samma exempel som 2a, med <?imcms:menuitemhide?> -->

  <?imcms:menu no="2"?>                                    <!-- Menyn påbörjas. Nummer två i sidan. -->

    <?imcms:menuitem?>                                     <!-- Första underdokumentsmallen påbörjas. -->

      <font color="red"> En länk: </font>                  <!-- Texten "En länk:" i röd färg. -->

      #menuitemlink##menuitemheadline##/menuitemlink#<br>  <!-- En länk till underdokumentet, med dess rubrik som länktext, och en radbrytning. -->

    <?/imcms:menuitem?>                                    <!-- Första underdokumentsmallen avslutas. -->

    <?imcms:menuitem?>                                     <!-- Andra underdokumentsmallen påbörjas. -->

      <?imcms:menuitemhide?>                               <!-- Start av data som försvinner om underdokument saknas. -->

        <font color="green"> En länk: </font>              <!-- Texten "En länk:" i grön färg. -->

        #menuitemlink##menuitemheadline##/menuitemlink#<br><!-- En länk till underdokumentet, med dess rubrik som länktext, och en radbrytning. -->

      <?/imcms:menuitemhide?>                              <!-- Avslutning av data som försvinner om underdokument saknas. --> 

    <?/imcms:menuitem?>                                    <!-- Andra underdokumentsmallen avslutas. -->

  <?/imcms:menu?>                                          <!-- Menyn avslutas. -->


<!-- Resultatexempel 2b, tre underdokument:

      <font color="red"> En länk: </font>

      <a href="GetDoc?meta_id=1001">Dokument 1001</a><br>


      <font color="green"> En länk: </font>

      <a href="GetDoc?meta_id=1002">Dokument 1002</a><br>


      <font color="red"> En länk: </font>

      <a href="GetDoc?meta_id=1003">Dokument 1003</a><br>

        Slut på resultatexempel.
  -->

<!-- 

     Nu ser vi att vi löst problemet från exempel 2a. Allting i elementet imcms:menuitemhide tas bort om underdokument saknas.
     Notera också att imcms:menuitemhide enbart är nödvändig i det andra imcms:menuitem-elementet,
     eftersom det första elementet kommer först i loopen, och alltid kommer att fyllas i vid en eventuell loop.

     Tyvärr blir det nödvändigt att använda imcms:menuitemhide nästan varje gång man har mer än en imcms:menuitem.
     En lösning på detta skulle vara trevligt.

  -->


<!-- Exempel 3a. En tabell som tas bort helt om underdokument saknas. Varje rad har en enkel länk. -->

  <?imcms:menu no="3"?>                                      <!-- Menyn påbörjas, nummer tre i sidan. -->

    <table>                                                  <!-- Tabellen påbörjas. Den kommer endast att komma med om det finns underdokument överhuvudtaget. -->

      <?imcms:menuloop?>                                     <!-- Loopen påbörjas. Nödvändig för att <table> och </table> inte ska upprepas. -->

        <?imcms:menuitem?>                                   <!-- Första underdokumentsmallen påbörjas. -->

          <tr>

            <td> 

	      #menuitemlink##menuitemheadline##/menuitemlink#<!-- En länk till underdokumentet, i en tabellrad. -->

            </td>

          </tr>

        <?/imcms:menuitem?>                                  <!-- Första underdokumentsmallen avslutas. -->

      <?/imcms:menuloop?>                                    <!-- Loopen avslutas. Nödvändig för att avgränsa loopen från </table> -->

    </table>                                                 <!-- Tabellen avslutas. -->

  <?/imcms:menu?>					     <!-- Menyn avslutas. -->


<!-- Resultatexempel 3a, tre underdokument:

    <table>


          <tr>

	    <td>

              <a href="GetDoc?meta_id=1001">Dokument 1001</a><br>

	    </td>

          </tr>


          <tr>

	    <td>

              <a href="GetDoc?meta_id=1002">Dokument 1002</a><br>

	    </td>

          </tr>


          <tr>

	    <td>

              <a href="GetDoc?meta_id=1003">Dokument 1003</a><br>

	    </td>

          </tr>


    </table>

        Slut på resultatexempel.
  -->

<!-- 

     Här ser vi hur man använder imcms:menuloop. Utan den hade även <table> och </table> inkluderats i loopen.
     Det kunde man ha löst genom att placera <table> och </table> utanför imcms:menu-elementet.
     Hade man gjort på det viset hade det dock resulterat i <table> och </table> i dokumentet även när underdokument saknas.

  -->


<!-- Exempel 3b. Som 3a, förutom att varje rad växlar mellan två bakgrundsfärger. -->

  <?imcms:menu no="3"?>                                      <!-- Menyn påbörjas, nummer tre i sidan. -->

    <table>                                                  <!-- Tabellen påbörjas. Den kommer endast att komma med om det finns underdokument överhuvudtaget. -->

      <?imcms:menuloop?>                                     <!-- Loopen påbörjas. Nödvändig för att <table> och </table> inte ska upprepas. -->

        <?imcms:menuitem?>                                   <!-- Första underdokumentsmallen påbörjas. -->

          <tr bgcolor="red">                                 <!-- Den här tabellraden får röd bakgrund. -->

            <td> 

	      #menuitemlink##menuitemheadline##/menuitemlink#<!-- En länk till underdokumentet, i en tabellrad. -->

            </td>

          </tr>

        <?/imcms:menuitem?>                                  <!-- Första underdokumentsmallen avslutas. -->

        <?imcms:menuitem?>                                   <!-- Andra underdokumentsmallen påbörjas. -->

          <tr bgcolor="green">                               <!-- Den här tabellraden får grön bakgrund. -->

            <td>

	      <?imcms:menuitemhide?>                         <!-- Plocka bort länken om underdokument saknas. -->

                #menuitemlink##menuitemheadline##/menuitemlink#<!-- En länk till underdokumentet, i en tabellrad. -->

	      <?/imcms:menuitemhide?>                        <!-- Slut på det som ska plockas bort om länken saknas.

            </td>

          </tr>

        <?/imcms:menuitem?>                                  <!-- Andra underdokumentsmallen avslutas. -->

      <?/imcms:menuloop?>                                    <!-- Loopen avslutas. Nödvändig för att avgränsa loopen från </table> -->

    </table>                                                 <!-- Tabellen avslutas. -->

  <?/imcms:menu?>					     <!-- Menyn avslutas. -->


<!-- Resultatexempel 3b, tre underdokument:

    <table>


          <tr bgcolor="red">

	    <td>

              <a href="GetDoc?meta_id=1001">Dokument 1001</a><br>

	    </td>

          </tr>


          <tr bgcolor="green">

	    <td>

              <a href="GetDoc?meta_id=1002">Dokument 1002</a><br>

	    </td>

          </tr>


          <tr bgcolor="red">

	    <td>

              <a href="GetDoc?meta_id=1003">Dokument 1003</a><br>

	    </td>

          </tr>

          <tr bgcolor="green">

	    <td>



	    </td>

          </tr>


    </table>

        Slut på resultatexempel.
  -->

<--

      Här använder vi imcms:menuitemhide för att plocka bort en länk inuti den sista cellen.
      Vi plockar inte bort hela cellen, eftersom det skulle kunna förstöra tabellen.

  -->


<!--
  Christoffer "Kreiger" Hammarström
  kreiger@imcode.com
                                 -->
